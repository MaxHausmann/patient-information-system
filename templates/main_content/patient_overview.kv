#:kivy 1.11.1

#:include templates/pulse_plot.kv

<MainContentPatientOverview@AnchorLayout>:
    name: "patient_overview"
    anchor_x: "center"
    anchor_y: "center"
    label_phone: label_phone
    label_name: label_name
    label_age: label_age
    diagnostics: diagnostics
    appraisal: appraisal

    BoxLayout:
        orientation: "vertical"
        padding: 20
        size_hint: 1, 1
        margin: 0

        BoxLayout:
            orientation: "vertical"
            size_hint: 1, 0.2

            Label:
                text: "[b]NACHNAME, VORNAME[/b] (m)"
                id: label_name
                font_size: 27
                text_size: self.size
                halign: "right"
                valign: "bottom"
                markup: True

            Label:
                text: "27 JAHRE"
                id: label_age
                font_size: 27
                text_size: self.size
                halign: "right"
                valign: "bottom"

            Label:
                text: "03641 / 2134412341"
                id: label_phone
                font_size: 16
                text_size: self.size
                halign: "right"


        # divider
        BoxLayout:
            size_hint: 1, 0.02

        Diagnostics:
            id: diagnostics
        
        # divider
        BoxLayout:
            size_hint: 1, 0.02

        Appraisal:
            id: appraisal

        # divider
        BoxLayout: 
            size_hint: 1, 0.02
    
        BoxLayout:
            orientation: "vertical"
            size_hint: 1, 0.2

            Label:
                text: "PULSMESSUNG"
                font_size: 23
                text_size: self.size
                size_hint: 1, 0.2

            PulsePlot:
                size_hint: 1, 0.8


<Diagnostics@BoxLayout>:
    orientation: "vertical"
    size_hint: 1, 0.2
    input_diagnostics: input_diagnostics
    list_diagnostics: list_diagnostics

    Label:
        text: "DIAGNOSTIK"
        font_size: 23
        text_size: self.size
        size_hint: 1, 0.2

    DiagnosticsList:
        id: list_diagnostics
        viewclass: "DiagnosticsLabel"
        size_hint: 1, 0.65
        
        RecycleBoxLayout:
            size_hint_y: None
            height: self.minimum_height
            orientation: "vertical"
            default_size: None, dp(40)
            default_size_hint: 1, None
            padding: 0, 10, 0, 10

    BoxLayout:
        orientation: "horizontal"
        size_hint: 1, 0.15

        TextInput:
            id: input_diagnostics
            hint_text: "Neue Diagnose..."
            size_hint: 0.8, 1
            font_size: self.height * 0.6
            cursor_color: 1, 1, 1, 1
            write_tab: False
            multiline: False

        Button:
            text: "Speichern"
            size_hint: 0.2, 1
            on_release:
                root.save_diag()


<DiagnosticsLabel@Label>:
    halign: "left"
    text_size: self.size
    markup: True
    canvas.before:
        Color:
            rgba: 1, 1, 1, .05
        Rectangle:
            pos: self.pos
            size: self.size

<Appraisal@BoxLayout>:
    orientation: "vertical"
    size_hint: 1, 0.2
    appraisal_list: appraisal_list
    
    Label:
        text: "BEFUNDUNG"
        font_size: 23
        text_size: self.size
        size_hint: 1, 0.2

    BoxLayout:
        orientation: "vertical"
        size_hint: 1, 0.8

        AppraisalView:
            id: appraisal_list
            viewclass: "AppraisalImage"
            size_hint: 1, 0.8
        
            RecycleBoxLayout:
                size_hint: 1, 1
                width: self.minimum_width
                orientation: "horizontal"
                #default_size: dp(80), None
                #default_size_hint: None, 1
                #default_size: None, dp(40)
                #default_size_hint: 1, None
                #padding: 0, 10, 0, 10
        
        Label:
            text: "Klicken zum Vergrößern/Bearbeiten"
            font_size: 15
            text_size: self.size
            size_hint: 1, 0.2
            halign: "center"


<AppraisalImage@Button>:
    source: ""
    first_button: False
    image: image

    Image:
        id: image
        source: root.source
        size: self.parent.width * 0.9, self.parent.height * 0.9
        center_x: self.parent.center_x
        center_y: self.parent.center_y
        allow_stretch: True

<AppraisalImageLoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserIconView:
            id: filechooser
            filters: ["*.jpeg"]

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Abbrechen"
                on_release: root.cancel()

            Button:
                text: "Öffnen"
                on_release: root.load(filechooser.path, filechooser.selection)

<AppraisalImageEditDialog>:

    input_value: input_value
    filter_selector: filter_selector

    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"

            Image:
                id: image
                source: root.source
                size_hint: 0.6, 1

            BoxLayout:
                orientation: "vertical"
                size_hint: 0.3, 1
                selected_filter: 0
                id: filter_selector

                Label:
                    text: "ANWENDBARE FILTER"
                    text_size: self.size
                    font_size: 25
                    size_hint: 1, 0.1
                
                FilterLine:
                    title: "Inversion"
                    num: 0

                FilterLine:
                    title: "Binarisierung"
                    num: 1

                FilterLine:
                    title: "Gamma-Korrektur"
                    num: 2

                FilterLine:
                    title: "Glättung"
                    num: 3

                FilterLine:
                    title: "Kantenerkennung (ver)"
                    num: 4

                FilterLine:
                    title: "Kantenerkennung (hor)"
                    num: 5

                BoxLayout:
                    orientation: "horizontal"
                    size_hint: 1, 0.05
                    Label:
                        text: "Wert"
                        text_size: self.size
                        size_hint: 0.8, 1
                        halign: "left"
                        valign: "center"
                    TextInput:
                        id: input_value
                        font_size: self.height * 0.6
                        cursor_color: 1, 1, 1, 1
                        write_tab: False
                        multiline: False
                        hint_text: "5"
                        size_hint: 0.2, 1
                    
        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Abbrechen"
                on_release: root.cancel()

            Button:
                text: "Anwenden"
                on_release: root.apply_filter()


<FilterLine@BoxLayout>:
    orientation: "horizontal"
    title: ""
    num: 0
    size_hint: 1, 0.1

    CheckBox:
        group: "filter"
        size_hint: 0.1, 1
        on_active:
            root.set_active()

    Label:
        text: root.title
        text_size: self.size
        halign: "left"
        valign: "center"
        size_hint: 0.9, 1

    
<LeaveDialog@Popup>:
    auto_dismiss: False
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        Label:
            text: "Wollen Sie den aktuellen Patient wirklich verlassen? Die Akte wird dann geschlossen."
            #text_size: self.size
            size_hint: 1, 0.7
            halign: "center"
            valgin: "center"

        BoxLayout:
            size_hint: 1, 0.3
            ortienation: "horizontal"

            Button:
                text: "Verlassen"
                on_release: root.leave(root.callback, root.next_content)

            Button:
                text: "Abbrechen"
                on_release: root.cancel()